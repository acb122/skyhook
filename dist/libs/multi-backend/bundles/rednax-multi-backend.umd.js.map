{"version":3,"file":"rednax-multi-backend.umd.js","sources":["../../../../libs/multi-backend/src/lib/HTML5ToTouch.ts","../../../../libs/multi-backend/src/lib/preview-renderer.component.ts","../../../../libs/multi-backend/src/lib/preview.component.ts","../../../../libs/multi-backend/src/lib/module.ts","../../../../libs/multi-backend/public-api.ts","../../../../libs/multi-backend/rednax-multi-backend.ts"],"sourcesContent":["import { HTML5Backend } from 'react-dnd-html5-backend';\nimport { TouchBackend } from 'react-dnd-touch-backend';\nimport {\n    MultiBackend,\n    MouseTransition,\n    TouchTransition,\n    BackendTransition,\n} from 'dnd-multi-backend';\nimport { BackendFactory } from 'dnd-core';\n\nexport const HTML5ToTouch = {\n    backends: [\n        {\n            backend: HTML5Backend,\n            transition: MouseTransition,\n        },\n        {\n            backend: (manager, ctx) =>\n                TouchBackend(manager, ctx, { enableMouseEvents: false }),\n            preview: true,\n            transition: TouchTransition,\n        },\n    ] as BackendTransition[],\n};\n\nexport function createDefaultMultiBackend(): BackendFactory {\n    return (manager, ctx) => MultiBackend(HTML5ToTouch)(manager, ctx);\n}\n","import { Component, ChangeDetectionStrategy } from '@angular/core';\nimport { SkyhookDndService, Offset } from '@rednax/core';\nimport { map } from 'rxjs/operators';\n// @ts-ignore\nimport { Observable } from 'rxjs';\n\n/**\n * This is internal, you probably won't ever need to use it directly.\n *\n * For understanding's sake, it helps to know that this component\n * essentially just renders whatever is placed between its tags, but\n * in a `position: fixed` container that is translated according to\n * the drag in progress and how far it has travelled.\n *\n * It currently has a workaround for some Firefox versions where the\n * whole thing wouldn't re-render unless you animated the border.\n */\n@Component({\n    selector: 'skyhook-preview-renderer',\n    template: `\n        <div class=\"firefox-bug\" [ngStyle]=\"style$ | async\">\n            <ng-content></ng-content>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                position: fixed;\n                pointer-events: none;\n                z-index: 100;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n            }\n            @keyframes animatedBorder {\n                from {\n                    border-color: rgba(0, 0, 0, 0);\n                }\n                to {\n                    border-color: rgba(0, 0, 0, 1);\n                }\n            }\n            .firefox-bug {\n                animation-name: animatedBorder;\n                animation-duration: 1s;\n                animation-iteration-count: infinite;\n                animation-timing-function: linear;\n            }\n        `,\n    ],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class SkyhookPreviewRendererComponent {\n    /** @ignore */\n    private layer = this.skyhook.dragLayer();\n\n    /** @ignore */\n    collect$ = this.layer.listen((monitor) => ({\n        initialOffset: monitor.getInitialSourceClientOffset() as Offset,\n        currentOffset: monitor.getSourceClientOffset(),\n    }));\n\n    /** @ignore */\n    style$ = this.collect$.pipe(\n        map((c) => {\n            const { initialOffset, currentOffset } = c;\n\n            if (!initialOffset || !currentOffset) {\n                return {\n                    display: 'none',\n                };\n            }\n\n            let { x, y } = currentOffset;\n\n            const transform = `translate(${x}px, ${y}px)`;\n            return {\n                transform,\n                WebkitTransform: transform,\n            };\n        })\n    );\n\n    /** @ignore */\n    constructor(private skyhook: SkyhookDndService) {}\n\n    /** @ignore */\n    ngOnDestroy() {\n        this.layer.unsubscribe();\n    }\n}\n","import {\n    Component,\n    TemplateRef,\n    ContentChild,\n    Input,\n    Inject,\n    ChangeDetectionStrategy,\n} from '@angular/core';\nimport { SkyhookDndService, DRAG_DROP_MANAGER } from '@rednax/core';\nimport { DragDropManager } from 'dnd-core';\n// @ts-ignore\nimport { Observable } from 'rxjs';\n\nexport interface PreviewTemplateContext {\n    /** same as type */\n    $implicit: string | symbol;\n    type: string | symbol;\n    item: Object & any;\n}\n\n/**\n * If you pass an `<ng-template let-type let-item=\"item\">` to `<skyhook-preview>` as a child,\n * then that template will be rendered so as to follow the mouse around while dragging.\n * What you put in that template is up to you, but in most cases this will be:\n *\n```html\n<skyhook-preview>\n  <ng-template let-type let-item=\"item\">\n    <ng-content [ngSwitch]=\"type\">\n      <!-- one kind of preview per type, using *ngSwitchCase=\"'TYPE'\" -->\n      <div *ngSwitchCase=\"'TYPE'\">{{ item | json }}</div>\n    </ng-content>\n  </ng-template>\n</skyhook-preview>\n```\n */\n@Component({\n    selector: 'skyhook-preview',\n    template: `\n        <ng-container *ngIf=\"collect$ | async as c\">\n            <skyhook-preview-renderer *ngIf=\"c.previewEnabled\">\n                <ng-container *ngIf=\"c.isDragging\">\n                    <ng-container\n                        *ngTemplateOutlet=\"\n                            content;\n                            context: {\n                                $implicit: c.itemType,\n                                type: c.itemType,\n                                item: c.item\n                            }\n                        \"\n                    >\n                    </ng-container>\n                </ng-container>\n            </skyhook-preview-renderer>\n        </ng-container>\n    `,\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class SkyhookPreviewComponent {\n    /** Disables the check for whether the current MultiBackend wants the preview enabled */\n    @Input() allBackends = false;\n\n    /** @ignore */\n    @ContentChild(TemplateRef, { static: false })\n    content!: TemplateRef<PreviewTemplateContext>;\n\n    /** @ignore */\n    private layer = this.skyhook.dragLayer();\n\n    // we don't need all the fast-moving props here, so this optimises change detection\n    // on the projected template's inputs (i.e. the context).\n    // the fast-moving stuff is contained in the preview renderer.\n    // also, we include this.isPreviewEnabled() because in this component with OnPush,\n    // a plain getter isn't checked more than once, and this forces it to be called on each event.\n    /** @ignore */\n    collect$ = this.layer.listen((monitor) => ({\n        item: monitor.getItem(),\n        itemType: monitor.getItemType(),\n        isDragging: monitor.isDragging(),\n        previewEnabled: this.isPreviewEnabled(),\n    }));\n\n    /** @ignore */\n    warned = false;\n\n    /** @ignore */\n    constructor(\n        private skyhook: SkyhookDndService,\n        @Inject(DRAG_DROP_MANAGER) private manager: DragDropManager\n    ) {}\n\n    /** @ignore */\n    ngOnDestroy() {\n        this.layer.unsubscribe();\n    }\n\n    /** @ignore */\n    warn(msg: string) {\n        if (!this.warned) {\n            console.warn(msg);\n        }\n        this.warned = true;\n    }\n\n    /** @ignore */\n    isPreviewEnabled() {\n        if (this.allBackends) {\n            return true;\n        }\n        if (this.manager == null) {\n            this.warn(\n                'no drag and drop manager defined, are you sure you imported SkyhookDndModule?'\n            );\n            return false;\n        }\n        const backend = this.manager.getBackend() as any;\n        if (backend == null) {\n            this.warn(\n                'no drag and drop backend defined, are you sure you imported SkyhookDndModule.forRoot(backend)?'\n            );\n            return false;\n        }\n        // for when you are not using dnd-multi-backend\n        if (backend.previewEnabled == null) {\n            return true;\n        }\n        return backend.previewEnabled();\n    }\n}\n","import { NgModule } from \"@angular/core\";\nimport { CommonModule } from \"@angular/common\";\nimport { SkyhookPreviewComponent } from \"./preview.component\";\nimport { SkyhookPreviewRendererComponent } from \"./preview-renderer.component\";\n\n/** @ignore */\nconst EXPORTS = [\n    SkyhookPreviewComponent,\n    SkyhookPreviewRendererComponent,\n];\n\n@NgModule({\n    imports: [CommonModule],\n    declarations: EXPORTS,\n    exports: EXPORTS,\n})\nexport class SkyhookMultiBackendModule {}\n","// import no symbols to get typings but not execute the monkey-patching module loader\n/// <reference path=\"src/lib/ambient.d.ts\" />\n// import { MultiBackend } from 'dnd-multi-backend';\nexport { TouchBackend } from 'react-dnd-touch-backend';\nexport { HTML5Backend } from 'react-dnd-html5-backend';\nexport {\n    MultiBackend,\n    createTransition,\n    HTML5DragTransition,\n    TouchTransition,\n    MouseTransition,\n} from 'dnd-multi-backend';\n\nexport {\n    HTML5ToTouch,\n    createDefaultMultiBackend,\n} from './src/lib/HTML5ToTouch';\nexport { SkyhookMultiBackendModule } from './src/lib/module';\nexport { SkyhookPreviewComponent } from './src/lib/preview.component';\nexport { SkyhookPreviewRendererComponent } from './src/lib/preview-renderer.component';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["HTML5Backend","MouseTransition","TouchBackend","TouchTransition","MultiBackend","map","i0.ɵɵelementStart","i0.ɵɵprojection","i0.ɵɵelementEnd","i0.ɵɵproperty","Component","ChangeDetectionStrategy","i0.ɵɵelementContainer","i0.ɵɵelementContainerStart","i0.ɵɵtemplate","i0.ɵɵelementContainerEnd","i0.ɵɵadvance","DRAG_DROP_MANAGER","TemplateRef","Inject","Input","ContentChild","CommonModule","NgModule"],"mappings":"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"}