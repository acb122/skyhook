{"version":3,"file":"rednax-multi-backend.js","sources":["../../../../libs/multi-backend/src/lib/HTML5ToTouch.ts","../../../../libs/multi-backend/src/lib/preview-renderer.component.ts","../../../../libs/multi-backend/src/lib/preview.component.ts","../../../../libs/multi-backend/src/lib/module.ts","../../../../libs/multi-backend/public-api.ts","../../../../libs/multi-backend/rednax-multi-backend.ts"],"sourcesContent":["import { HTML5Backend } from 'react-dnd-html5-backend';\nimport { TouchBackend } from 'react-dnd-touch-backend';\nimport {\n    MultiBackend,\n    MouseTransition,\n    TouchTransition,\n    BackendTransition,\n} from 'dnd-multi-backend';\nimport { BackendFactory } from 'dnd-core';\n\nexport const HTML5ToTouch = {\n    backends: [\n        {\n            backend: HTML5Backend,\n            transition: MouseTransition,\n        },\n        {\n            backend: (manager, ctx) =>\n                TouchBackend(manager, ctx, { enableMouseEvents: false }),\n            preview: true,\n            transition: TouchTransition,\n        },\n    ] as BackendTransition[],\n};\n\nexport function createDefaultMultiBackend(): BackendFactory {\n    return (manager, ctx) => MultiBackend(HTML5ToTouch)(manager, ctx);\n}\n","import { Component, ChangeDetectionStrategy } from '@angular/core';\nimport { SkyhookDndService, Offset } from '@rednax/core';\nimport { map } from 'rxjs/operators';\n// @ts-ignore\nimport { Observable } from 'rxjs';\n\n/**\n * This is internal, you probably won't ever need to use it directly.\n *\n * For understanding's sake, it helps to know that this component\n * essentially just renders whatever is placed between its tags, but\n * in a `position: fixed` container that is translated according to\n * the drag in progress and how far it has travelled.\n *\n * It currently has a workaround for some Firefox versions where the\n * whole thing wouldn't re-render unless you animated the border.\n */\n@Component({\n    selector: 'skyhook-preview-renderer',\n    template: `\n        <div class=\"firefox-bug\" [ngStyle]=\"style$ | async\">\n            <ng-content></ng-content>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                position: fixed;\n                pointer-events: none;\n                z-index: 100;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n            }\n            @keyframes animatedBorder {\n                from {\n                    border-color: rgba(0, 0, 0, 0);\n                }\n                to {\n                    border-color: rgba(0, 0, 0, 1);\n                }\n            }\n            .firefox-bug {\n                animation-name: animatedBorder;\n                animation-duration: 1s;\n                animation-iteration-count: infinite;\n                animation-timing-function: linear;\n            }\n        `,\n    ],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class SkyhookPreviewRendererComponent {\n    /** @ignore */\n    private layer = this.skyhook.dragLayer();\n\n    /** @ignore */\n    collect$ = this.layer.listen((monitor) => ({\n        initialOffset: monitor.getInitialSourceClientOffset() as Offset,\n        currentOffset: monitor.getSourceClientOffset(),\n    }));\n\n    /** @ignore */\n    style$ = this.collect$.pipe(\n        map((c) => {\n            const { initialOffset, currentOffset } = c;\n\n            if (!initialOffset || !currentOffset) {\n                return {\n                    display: 'none',\n                };\n            }\n\n            let { x, y } = currentOffset;\n\n            const transform = `translate(${x}px, ${y}px)`;\n            return {\n                transform,\n                WebkitTransform: transform,\n            };\n        })\n    );\n\n    /** @ignore */\n    constructor(private skyhook: SkyhookDndService) {}\n\n    /** @ignore */\n    ngOnDestroy() {\n        this.layer.unsubscribe();\n    }\n}\n","import {\n    Component,\n    TemplateRef,\n    ContentChild,\n    Input,\n    Inject,\n    ChangeDetectionStrategy,\n} from '@angular/core';\nimport { SkyhookDndService, DRAG_DROP_MANAGER } from '@rednax/core';\nimport { DragDropManager } from 'dnd-core';\n// @ts-ignore\nimport { Observable } from 'rxjs';\n\nexport interface PreviewTemplateContext {\n    /** same as type */\n    $implicit: string | symbol;\n    type: string | symbol;\n    item: Object & any;\n}\n\n/**\n * If you pass an `<ng-template let-type let-item=\"item\">` to `<skyhook-preview>` as a child,\n * then that template will be rendered so as to follow the mouse around while dragging.\n * What you put in that template is up to you, but in most cases this will be:\n *\n```html\n<skyhook-preview>\n  <ng-template let-type let-item=\"item\">\n    <ng-content [ngSwitch]=\"type\">\n      <!-- one kind of preview per type, using *ngSwitchCase=\"'TYPE'\" -->\n      <div *ngSwitchCase=\"'TYPE'\">{{ item | json }}</div>\n    </ng-content>\n  </ng-template>\n</skyhook-preview>\n```\n */\n@Component({\n    selector: 'skyhook-preview',\n    template: `\n        <ng-container *ngIf=\"collect$ | async as c\">\n            <skyhook-preview-renderer *ngIf=\"c.previewEnabled\">\n                <ng-container *ngIf=\"c.isDragging\">\n                    <ng-container\n                        *ngTemplateOutlet=\"\n                            content;\n                            context: {\n                                $implicit: c.itemType,\n                                type: c.itemType,\n                                item: c.item\n                            }\n                        \"\n                    >\n                    </ng-container>\n                </ng-container>\n            </skyhook-preview-renderer>\n        </ng-container>\n    `,\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class SkyhookPreviewComponent {\n    /** Disables the check for whether the current MultiBackend wants the preview enabled */\n    @Input() allBackends = false;\n\n    /** @ignore */\n    @ContentChild(TemplateRef, { static: false })\n    content!: TemplateRef<PreviewTemplateContext>;\n\n    /** @ignore */\n    private layer = this.skyhook.dragLayer();\n\n    // we don't need all the fast-moving props here, so this optimises change detection\n    // on the projected template's inputs (i.e. the context).\n    // the fast-moving stuff is contained in the preview renderer.\n    // also, we include this.isPreviewEnabled() because in this component with OnPush,\n    // a plain getter isn't checked more than once, and this forces it to be called on each event.\n    /** @ignore */\n    collect$ = this.layer.listen((monitor) => ({\n        item: monitor.getItem(),\n        itemType: monitor.getItemType(),\n        isDragging: monitor.isDragging(),\n        previewEnabled: this.isPreviewEnabled(),\n    }));\n\n    /** @ignore */\n    warned = false;\n\n    /** @ignore */\n    constructor(\n        private skyhook: SkyhookDndService,\n        @Inject(DRAG_DROP_MANAGER) private manager: DragDropManager\n    ) {}\n\n    /** @ignore */\n    ngOnDestroy() {\n        this.layer.unsubscribe();\n    }\n\n    /** @ignore */\n    warn(msg: string) {\n        if (!this.warned) {\n            console.warn(msg);\n        }\n        this.warned = true;\n    }\n\n    /** @ignore */\n    isPreviewEnabled() {\n        if (this.allBackends) {\n            return true;\n        }\n        if (this.manager == null) {\n            this.warn(\n                'no drag and drop manager defined, are you sure you imported SkyhookDndModule?'\n            );\n            return false;\n        }\n        const backend = this.manager.getBackend() as any;\n        if (backend == null) {\n            this.warn(\n                'no drag and drop backend defined, are you sure you imported SkyhookDndModule.forRoot(backend)?'\n            );\n            return false;\n        }\n        // for when you are not using dnd-multi-backend\n        if (backend.previewEnabled == null) {\n            return true;\n        }\n        return backend.previewEnabled();\n    }\n}\n","import { NgModule } from \"@angular/core\";\nimport { CommonModule } from \"@angular/common\";\nimport { SkyhookPreviewComponent } from \"./preview.component\";\nimport { SkyhookPreviewRendererComponent } from \"./preview-renderer.component\";\n\n/** @ignore */\nconst EXPORTS = [\n    SkyhookPreviewComponent,\n    SkyhookPreviewRendererComponent,\n];\n\n@NgModule({\n    imports: [CommonModule],\n    declarations: EXPORTS,\n    exports: EXPORTS,\n})\nexport class SkyhookMultiBackendModule {}\n","// import no symbols to get typings but not execute the monkey-patching module loader\n/// <reference path=\"src/lib/ambient.d.ts\" />\n// import { MultiBackend } from 'dnd-multi-backend';\nexport { TouchBackend } from 'react-dnd-touch-backend';\nexport { HTML5Backend } from 'react-dnd-html5-backend';\nexport {\n    MultiBackend,\n    createTransition,\n    HTML5DragTransition,\n    TouchTransition,\n    MouseTransition,\n} from 'dnd-multi-backend';\n\nexport {\n    HTML5ToTouch,\n    createDefaultMultiBackend,\n} from './src/lib/HTML5ToTouch';\nexport { SkyhookMultiBackendModule } from './src/lib/module';\nexport { SkyhookPreviewComponent } from './src/lib/preview.component';\nexport { SkyhookPreviewRendererComponent } from './src/lib/preview-renderer.component';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i0.ɵɵelementStart","i0.ɵɵprojection","i0.ɵɵelementEnd","i0.ɵɵproperty","i0.ɵɵelementContainer","i0.ɵɵelementContainerStart","i0.ɵɵtemplate","i0.ɵɵelementContainerEnd","i0.ɵɵadvance"],"mappings":";;;;;;;;;;;MAUa,YAAY,GAAG;IACxB,QAAQ,EAAE;QACN;YACI,OAAO,EAAE,YAAY;YACrB,UAAU,EAAE,eAAe;SAC9B;QACD;YACI,OAAO,EAAE,CAAC,OAAO,EAAE,GAAG,KAClB,YAAY,CAAC,OAAO,EAAE,GAAG,EAAE,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC;YAC5D,OAAO,EAAE,IAAI;YACb,UAAU,EAAE,eAAe;SAC9B;KACmB;EAC1B;SAEc,yBAAyB;IACrC,OAAO,CAAC,OAAO,EAAE,GAAG,KAAK,YAAY,CAAC,YAAY,CAAC,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;AACtE;;;ACrBA;;;;;;;;;;;MAgDa,+BAA+B;;IAgCxC,YAAoB,OAA0B;QAA1B,YAAO,GAAP,OAAO,CAAmB;;QA9BtC,UAAK,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC;;QAGzC,aAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,OAAO,MAAM;YACvC,aAAa,EAAE,OAAO,CAAC,4BAA4B,EAAY;YAC/D,aAAa,EAAE,OAAO,CAAC,qBAAqB,EAAE;SACjD,CAAC,CAAC,CAAC;;QAGJ,WAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CACvB,GAAG,CAAC,CAAC,CAAC;YACF,MAAM,EAAE,aAAa,EAAE,aAAa,EAAE,GAAG,CAAC,CAAC;YAE3C,IAAI,CAAC,aAAa,IAAI,CAAC,aAAa,EAAE;gBAClC,OAAO;oBACH,OAAO,EAAE,MAAM;iBAClB,CAAC;aACL;YAED,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,aAAa,CAAC;YAE7B,MAAM,SAAS,GAAG,aAAa,CAAC,OAAO,CAAC,KAAK,CAAC;YAC9C,OAAO;gBACH,SAAS;gBACT,eAAe,EAAE,SAAS;aAC7B,CAAC;SACL,CAAC,CACL,CAAC;KAGgD;;IAGlD,WAAW;QACP,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;KAC5B;;8GArCQ,+BAA+B;iEAA/B,+BAA+B;;QAlCpCA,2BACI;;QAAAC,eAAY;QAChBC,cAAM;;QAFmBC,oDAA0B;;+CAkC9C,+BAA+B;cArC3C,SAAS;eAAC;gBACP,QAAQ,EAAE,0BAA0B;gBACpC,QAAQ,EAAE;;;;KAIT;gBACD,MAAM,EAAE;oBACJ;;;;;;;;;;;;;;;;;;;;;;;;;SAyBC;iBACJ;gBACD,eAAe,EAAE,uBAAuB,CAAC,MAAM;aAClD;;;;ICXmBC,qBAUe;;;;IAXnBC,0BACI;IAAAC,gJAUA;IACJC,uBAAe;;;;IAVPC,YAOC;IAPDL,8CAOC,+FAAA;;;IAVbH,6CACI;IAAAM,iIACI;IAYRJ,cAA2B;;;IAbTM,YAAoB;IAApBL,mCAAoB;;;IAF1CE,0BACI;IAAAC,8HACI;IAcRC,uBAAe;;;IAfeC,YAAwB;IAAxBL,uCAAwB;;AApB9D;;;;;;;;;;;;;;;;MAuCa,uBAAuB;;IA4BhC,YACY,OAA0B,EACC,OAAwB;QADnD,YAAO,GAAP,OAAO,CAAmB;QACC,YAAO,GAAP,OAAO,CAAiB;;QA5BtD,gBAAW,GAAG,KAAK,CAAC;;QAOrB,UAAK,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC;;;;;;;QAQzC,aAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,OAAO,MAAM;YACvC,IAAI,EAAE,OAAO,CAAC,OAAO,EAAE;YACvB,QAAQ,EAAE,OAAO,CAAC,WAAW,EAAE;YAC/B,UAAU,EAAE,OAAO,CAAC,UAAU,EAAE;YAChC,cAAc,EAAE,IAAI,CAAC,gBAAgB,EAAE;SAC1C,CAAC,CAAC,CAAC;;QAGJ,WAAM,GAAG,KAAK,CAAC;KAMX;;IAGJ,WAAW;QACP,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;KAC5B;;IAGD,IAAI,CAAC,GAAW;QACZ,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACd,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACrB;QACD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;KACtB;;IAGD,gBAAgB;QACZ,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,OAAO,IAAI,CAAC;SACf;QACD,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,EAAE;YACtB,IAAI,CAAC,IAAI,CACL,+EAA+E,CAClF,CAAC;YACF,OAAO,KAAK,CAAC;SAChB;QACD,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,EAAS,CAAC;QACjD,IAAI,OAAO,IAAI,IAAI,EAAE;YACjB,IAAI,CAAC,IAAI,CACL,gGAAgG,CACnG,CAAC;YACF,OAAO,KAAK,CAAC;SAChB;;QAED,IAAI,OAAO,CAAC,cAAc,IAAI,IAAI,EAAE;YAChC,OAAO,IAAI,CAAC;SACf;QACD,OAAO,OAAO,CAAC,cAAc,EAAE,CAAC;KACnC;;8FArEQ,uBAAuB,0DA8BpB,iBAAiB;yDA9BpB,uBAAuB;iCAKlB,WAAW;;;;;QAzBrBG,uFACI;;;QADUH,mDAA6B;;+CAoBtC,uBAAuB;cAvBnC,SAAS;eAAC;gBACP,QAAQ,EAAE,iBAAiB;gBAC3B,QAAQ,EAAE;;;;;;;;;;;;;;;;;;KAkBT;gBACD,eAAe,EAAE,uBAAuB,CAAC,MAAM;aAClD;;sBA+BQ,MAAM;uBAAC,iBAAiB;wBA5BpB,WAAW;kBAAnB,KAAK;YAIN,OAAO;kBADN,YAAY;mBAAC,WAAW,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE;;;AC3DhD;AACA,MAAM,OAAO,GAAG;IACZ,uBAAuB;IACvB,+BAA+B;CAClC,CAAC;MAOW,yBAAyB;;0DAAzB,yBAAyB;8HAAzB,yBAAyB,kBAJzB,CAAC,YAAY,CAAC;qFAId,yBAAyB,mBATlC,uBAAuB;QACvB,+BAA+B,aAIrB,YAAY,aALtB,uBAAuB;QACvB,+BAA+B;+CAQtB,yBAAyB;cALrC,QAAQ;eAAC;gBACN,OAAO,EAAE,CAAC,YAAY,CAAC;gBACvB,YAAY,EAAE,OAAO;gBACrB,OAAO,EAAE,OAAO;aACnB;;;ACfD;;ACAA;;;;;;"}